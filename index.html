<!DOCTYPE html>
<html>
  <head>
    <title>Effective use of Shiny modules</title>
    <meta charset="utf-8">
    <meta name="author" content="Eric Nantz" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis-fonts.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/fontawesome-all.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="custom_css/footer.css" type="text/css" />
    <link rel="stylesheet" href="custom_css/misc.css" type="text/css" />
    <link rel="stylesheet" href="custom_css/animate.css" type="text/css" />
    <link rel="stylesheet" href="custom_css/road.css" type="text/css" />
    <link rel="stylesheet" href="custom_css/two_columns.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Effective use of Shiny modules
## rstudio::conf 2019 (very rough draft)
### Eric Nantz
### 2019/1/17

---




layout: true

&lt;div class="my-footer"&gt;&lt;span&gt;bit.ly/modules2019&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;Effective use of Shiny Modules&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;rstudio::conf 2019&lt;/span&gt;&lt;/div&gt; 

---

# My Journey with Shiny

.pull-left[
Early adopter when Shiny was released to CRAN

__First efforts__: Small prototypes to showcase possibilities and [learn by doing](https://r-podcast.org/15)

<i class="fas  fa-rocket "></i> Ascend Joe Cheng's [ladder of enlightment](https://github.com/rstudio/ShinyDeveloperConference/blob/45737f1f3386fb3a9194c40f9a999b58f60971de/Reactivity/slides.Rmd#L233-L240) 

Present day: Developer of __large and complex__ applications integrating multiple systems
]

.pull-right[
![:scale 90%](img/Flynnuser.png)
]

---

# Case Study

Empower statisticians with little/no <i class="fab  fa-r-project " style="color:#384CB7;"></i> experience to perform subgroup identification based on [TSDT](https://cran.rstudio.com/web/packages/TSDT/) package

üöß Non-trivial requirements (persistent sessions, dynamic UI, HPC integration)

--

__Difficulties__

* Duplicated similar(ish) UI widgets across app
* Code not organized well
* Extending capabilities was challenging

--

## What can solve many of these issues?

---

background-image: url(img/key.gif)
background-size: cover

class: inverse, clear, center, middle

# Modules to the Rescue!

---

# What are Modules?

--

## Functions optimized for Shiny applications

--

- Avoid namespace collisions when using same widget across different parts of your app
- Allows you to encapsulate distinct app components
- Organize code into logical and easy-to-understand components
- Facilitates collaboration

--

## Sound familiar?

--

- <i class="fab  fa-r-project " style="color:#384CB7;"></i> functions help avoid collisions in variable names with general R code
- Essential for creating non-trivial and extensive workflows

---

background-image: url(img/roadsunset17.png)
background-size: cover

class: inverse, clear, center, top

.center[
## Road to Modules Mastery
]

--

&lt;div class="step1"&gt;(1) Creating/using simple modules occassionally&lt;/div&gt;
--

&lt;div class="step2"&gt;(2) Communication with modules&lt;/div&gt;
&lt;div class="step3"&gt;(3) Communication between sibling modules&lt;/div&gt;

---

# Example: Ames Housing Explorer

![](img/ames_explorer_screenshot.png)

[rpodcast.shinyapps.io/ames_explorer](https://rpodcast.shinyapps.io/ames_explorer)

???

__TODO__: Ask about swapping for animated gif (was a resource hog when interactively viewing slides)

* Side-by-side scatterplots with variable choices
* Select points via Shiny's interactive [plot brushing](http://shiny.rstudio.com/articles/selecting-rows-of-data.html)
* View additional variables inside a [DT](https://rstudio.github.io/DT/) data table
* Ability to annotate total sales price for data points in table

---

# Variable Selection

.left-column-big[

```r
#' Variable selection module server-side processing
#'
*#' @param input, output, session standard \code{shiny} boilerplate
#'
*#' @return list with following components
#' \describe{
#'   \item{xvar}{reactive character string indicating x variable selection}
#'   \item{yvar}{reactive character string indicating y variable selection}
#' }
varselect_mod_server &lt;- function(input, output, session) {

* return(
*   list(
*     xvar = reactive({ input$xvar }),
*     yvar = reactive({ input$yvar })
*   )
* )
}
```
]

.right-column-small[

üóí Document a module's input(s) and return value(s)

Constructing a named list articulates the __intent__ of a module
]

---

# Scatterplot Module

.left-column-big[
.code50[

```r
#' Scatterplot module server-side processing
#'
#' This module produces a scatterplot with the sales price against a variable selected by the user.
#' 
#' @param input,output,session standard \code{shiny} boilerplate
#' @param dataset data frame (non-reactive) with variables necessary for scatterplot
*#' @param plot1_vars list containing reactive x-variable name (called `xvar`) and y-variable name (called `yvar`) for plot 1
*#' @param plot2_vars list containing reactive x-variable name (called `xvar`) and y-variable name (called `yvar`) for plot 2
scatterplot_server_mod &lt;- function(input, 
                            output, 
                            session, 
                            dataset, 
                            plot1vars,
                            plot2vars) {
  
  
  plot1_obj &lt;- reactive({
*   p &lt;- scatter_sales(dataset, xvar = plot1vars$xvar(), yvar = plot1vars$yvar())
    return(p)
  })
  
  plot2_obj &lt;- reactive({
*   p &lt;- scatter_sales(dataset, xvar = plot2vars$xvar(), yvar = plot2vars$yvar())
    return(p)
  })
  
  output$plot1 &lt;- renderPlot({
    plot1_obj()
  })
  
  output$plot2 &lt;- renderPlot({
    plot2_obj()
  })
}
```
]
]

.right-column-small[
Clearly-defined object types for `plot1vars` and `plot2vars` inputs

How to correctly reference these inputs?

‚ùå `plot1vars()$yvar`

‚úÖ `plot1vars$yvar()`
]

---

class: inverse, clear, center, middle

# What does it all mean?

---

# You may already know...

* <i class="fab  fa-r-project " style="color:#384CB7;"></i> is well-suited for interactive workflows in data science

* Functions become an essential building-block when moving from prototypes to non-trivial workflows

--

## Is it any different when creating Shiny apps?  No!

* Shiny modules are __essential__ to bring software engineering best practices to application development

---

# Call to action

* Read the new article on module communication best practices at the Shiny site
* Watch for more articles this year on additional module topics
* Review Ames Housing Explorer app that demonstrates many of these concepts


---
class: fullscreen, inverse, center, text-black

.font250[**Backup**]

---





---

# What is a module?


---

# Why should we care?



---

# Learning Modules

- I started using modules in basic ways (apps with maybe 1-2 modules reused in different parts)
- More for display and having convenient UI widgets
- Over time: Complex applications with many modules (20 plus)
    + Forced to think carefully about orchestration &amp; how to reliably link (compose) modules together
    + (pic of music conductor? maybe too corny)

---

# Roadmap for using modules in complex apps

1. Creating and using simple modules occassionally
2. Communication with modules (receiving input and returning output)
3. Communication between sibling modules (parent in charge) (this is more of 2 above)
4. (May not include0) Modules that use other modules as inputs / parameters



---

# Basic Example

Use modules from first article (variable chooser and scatterplot)
* Only one plot for simplicity
* Variable select: Demonstrates simple UI (two select inputs)
* Plot module: Demonstrates displaying output based on input parameters

__Key Points__
* Be explicit about the __contract__ for a module
* Document the inputs and return values much like an R function
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="macros.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
